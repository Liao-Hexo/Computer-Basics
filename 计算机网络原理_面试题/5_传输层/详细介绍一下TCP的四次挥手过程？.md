![](https://tva1.sinaimg.cn/large/008i3skNly1gt3qflyuhaj30vk0tigoc.jpg)

第一次挥手：客户端向服务端发送连接释放报文（FIN=1），主动关闭连接，同时等待服务端的确认。

第二次挥手：服务端收到连接释放报文后，立即发出确认报文（ACK=1），序列号 seq = k，确认号 ack = u + 1。

这时 TCP 连接处于半关闭状态，即客户端到服务端的连接已经释放了，但是服务端到客户端的连接还未释放。这表示客户端已经没有数据发送了，但是服务端可能还要给客户端发送数据。

第三次挥手：服务端向客户端发送连接释放报文（FIN=1，ACK=1），主动关闭连接，同时等待 A 的确认。

* 序列号 seq = w，即服务端上次发送的报文的最后一个字节的序号 + 1。
* 确认号 ack = u + 1，与第二次挥手相同，因为这段时间客户端没有发送数据

第四次挥手：客户端收到服务端的连接释放报文后，立即发出确认报文（ACK=1），序列号 seq = u + 1，确认号为 ack = w + 1。

此时，客户端就进入了 TIME-WAIT 状态。注意此时客户端到 TCP 连接还没有释放，必须经过 2*MSL（最长报文段寿命）的时间后，才进入 CLOSED 状态。而服务端只要收到客户端发出的确认，就立即进入 CLOSED 状态。可以看到，服务端结束 TCP 连接的时间要比客户端早一些。